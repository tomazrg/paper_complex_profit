[
  {
    "objectID": "profit.html",
    "href": "profit.html",
    "title": "Framework modeling",
    "section": "",
    "text": "library(gsheet)\nlibrary(tidyverse)\n\n── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n✔ dplyr     1.1.4     ✔ readr     2.1.6\n✔ forcats   1.0.1     ✔ stringr   1.6.0\n✔ ggplot2   4.0.1     ✔ tibble    3.3.0\n✔ lubridate 1.9.4     ✔ tidyr     1.3.1\n✔ purrr     1.2.0     \n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\nℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors\n\nlibrary(lme4)\n\nLoading required package: Matrix\n\nAttaching package: 'Matrix'\n\nThe following objects are masked from 'package:tidyr':\n\n    expand, pack, unpack\n\nlibrary(metan)\n\n|=========================================================|\n| Multi-Environment Trial Analysis (metan) v1.19.0        |\n| Author: Tiago Olivoto                                   |\n| Type 'citation('metan')' to know how to cite metan      |\n| Type 'vignette('metan_start')' for a short tutorial     |\n| Visit 'https://bit.ly/metanpkg' for a complete tutorial |\n|=========================================================|\n\nAttaching package: 'metan'\n\nThe following object is masked from 'package:forcats':\n\n    as_factor\n\nThe following object is masked from 'package:dplyr':\n\n    recode_factor\n\nThe following object is masked from 'package:tidyr':\n\n    replace_na\n\nThe following objects are masked from 'package:tibble':\n\n    column_to_rownames, remove_rownames, rownames_to_column\n\nlibrary(DHARMa)\n\nThis is DHARMa 0.4.7. For overview type '?DHARMa'. For recent changes, type news(package = 'DHARMa')\n\nlibrary(metafor)\n\nLoading required package: metadat\nLoading required package: numDeriv\n\nLoading the 'metafor' package (version 4.8-0). For an\nintroduction to the package please type: help(metafor)\n\nlibrary(cowplot)\n\n\nAttaching package: 'cowplot'\n\nThe following object is masked from 'package:lubridate':\n\n    stamp\n\nlibrary(patchwork)\n\n\nAttaching package: 'patchwork'\n\nThe following object is masked from 'package:cowplot':\n\n    align_plots"
  },
  {
    "objectID": "profit.html#packages",
    "href": "profit.html#packages",
    "title": "Framework modeling",
    "section": "",
    "text": "library(gsheet)\nlibrary(tidyverse)\n\n── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n✔ dplyr     1.1.4     ✔ readr     2.1.6\n✔ forcats   1.0.1     ✔ stringr   1.6.0\n✔ ggplot2   4.0.1     ✔ tibble    3.3.0\n✔ lubridate 1.9.4     ✔ tidyr     1.3.1\n✔ purrr     1.2.0     \n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\nℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors\n\nlibrary(lme4)\n\nLoading required package: Matrix\n\nAttaching package: 'Matrix'\n\nThe following objects are masked from 'package:tidyr':\n\n    expand, pack, unpack\n\nlibrary(metan)\n\n|=========================================================|\n| Multi-Environment Trial Analysis (metan) v1.19.0        |\n| Author: Tiago Olivoto                                   |\n| Type 'citation('metan')' to know how to cite metan      |\n| Type 'vignette('metan_start')' for a short tutorial     |\n| Visit 'https://bit.ly/metanpkg' for a complete tutorial |\n|=========================================================|\n\nAttaching package: 'metan'\n\nThe following object is masked from 'package:forcats':\n\n    as_factor\n\nThe following object is masked from 'package:dplyr':\n\n    recode_factor\n\nThe following object is masked from 'package:tidyr':\n\n    replace_na\n\nThe following objects are masked from 'package:tibble':\n\n    column_to_rownames, remove_rownames, rownames_to_column\n\nlibrary(DHARMa)\n\nThis is DHARMa 0.4.7. For overview type '?DHARMa'. For recent changes, type news(package = 'DHARMa')\n\nlibrary(metafor)\n\nLoading required package: metadat\nLoading required package: numDeriv\n\nLoading the 'metafor' package (version 4.8-0). For an\nintroduction to the package please type: help(metafor)\n\nlibrary(cowplot)\n\n\nAttaching package: 'cowplot'\n\nThe following object is masked from 'package:lubridate':\n\n    stamp\n\nlibrary(patchwork)\n\n\nAttaching package: 'patchwork'\n\nThe following object is masked from 'package:cowplot':\n\n    align_plots"
  },
  {
    "objectID": "profit.html#break-even",
    "href": "profit.html#break-even",
    "title": "Framework modeling",
    "section": "Break-even",
    "text": "Break-even\n\nG_crit &lt;- function(price, cost){\n  1000 * cost / price\n}\n\nnet_return &lt;- function(G, price, cost){\n  G * price / 1000 - cost\n}\n\nprob_positive &lt;- function(G_hat, se_G, price, cost){\n  Gc &lt;- G_crit(price, cost)\n  1 - pnorm((Gc - G_hat) / se_G)\n}\n\n\nVariables\n\nprice_vec &lt;- c(100,125, 150,175,200,225, 250)\ncost_vec  &lt;- c(15,30,45, 60,75,90,105)\n\n#sev = seq(5, 60,length.out = 400)\n#yld = seq(4000, 12000,length.out = 400)\n\n\nscenarios &lt;- expand.grid(price = price_vec,\n                         cost  = cost_vec)\n\n\n\nFirst season\n\nscenarios_first_high = scenarios\n\nscenarios_first_high$season  = \"First season\"\n\nscenarios_first_high$Gcrit_hf  &lt;- with(scenarios_first_high, G_crit(price, cost))\nscenarios_first_high$Net_hf    &lt;- with(scenarios_first_high, net_return(1883, price, cost))\nscenarios_first_high$Prob_hf   &lt;- with(scenarios_first_high, prob_positive(1883, 309.0,\n                                                        price, cost))\nscenarios_first_high$pressure = \"High pressure\"\n\n\nscenarios_first_low = scenarios\n\nscenarios_first_low$season  = \"First season\"\n\nscenarios_first_low$Gcrit_hf  &lt;- with(scenarios_first_low, G_crit(price, cost))\nscenarios_first_low$Net_hf    &lt;- with(scenarios_first_low, net_return(326, price, cost))\nscenarios_first_low$Prob_hf   &lt;- with(scenarios_first_low, prob_positive(326, 67.1,\n                                                        price, cost))\nscenarios_first_low$pressure = \"Low pressure\"\n\n\n\nSecond season\n\nscenarios_second_high = scenarios\n\nscenarios_second_high$season  = \"Second season\"\n\nscenarios_second_high$Gcrit_hf  &lt;- with(scenarios_second_high, G_crit(price, cost))\nscenarios_second_high$Net_hf    &lt;- with(scenarios_second_high, net_return(3077, price, cost))\nscenarios_second_high$Prob_hf   &lt;- with(scenarios_second_high, prob_positive(3077, 576.0,\n                                                        price, cost))\nscenarios_second_high$pressure = \"High pressure\"\n\n\nscenarios_second_low = scenarios\n\nscenarios_second_low$season  = \"Second season\"\n\nscenarios_second_low$Gcrit_hf  &lt;- with(scenarios_second_low, G_crit(price, cost))\nscenarios_second_low$Net_hf    &lt;- with(scenarios_second_low, net_return(333, price, cost))\nscenarios_second_low$Prob_hf   &lt;- with(scenarios_second_low, prob_positive(333, 54.0,\n                                                        price, cost))\nscenarios_second_low$pressure = \"Low pressure\"\n\n\nscenarios_all = rbind(scenarios_first_high,scenarios_first_low,scenarios_second_high,scenarios_second_low)\n\n\nPlotting\n\nscenarios_all %&gt;% \n  ggplot(aes(as.factor(cost),as.factor(price), fill = Prob_hf))+ \n  geom_tile(color = \"white\", size = 0.5)+\n    scale_fill_distiller(palette = \"RdYlGn\",breaks = seq(0, 1, by =0.25),direction = 1)+\n  ggthemes::theme_few()+\n  facet_wrap(~season+pressure)+\n  labs(y = \"Maize price (USD/ton)\",\n       x = \"Management cost (USD/ha)\",\n       fill =\"Pr(I \\u2265 C)\" )+\n  theme(legend.position = \"right\",\n        legend.justification = 0.5,\n        text = element_text(size = 12, face = \"bold\"),\n        axis.text.x = element_text(size = 12, face = \"bold\"),   \n        axis.text.y = element_text(size = 12, face = \"bold\"))\n\nWarning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.\nℹ Please use `linewidth` instead.\n\n\n\n\n\n\n\n\n\n\nggsave(\"fig/heat.png\", dpi = 1000, bg = \"white\", height = 4, width = 6)"
  },
  {
    "objectID": "profit.html#economic-return",
    "href": "profit.html#economic-return",
    "title": "Framework modeling",
    "section": "Economic return",
    "text": "Economic return\n\nlibrary(ggdist)\nscenarios_all %&gt;% \nggplot(aes(Net_hf)) +\n #geom_histogram(color  = \"white\",fill = \"black\")+\n  stat_halfeye(fill = \"orange\", alpha = 0.7)+ #ffc425\n  facet_wrap(~ season+pressure)+\nscale_x_continuous(breaks = seq(-50, 800, by = 150)) +\n  ggthemes::theme_few()+\n  labs(\n    y = \"Density\",\n    x = \"Economic return (USD/ha)\")+\n    theme(text = element_text(size = 12, face = \"bold\"),\n        axis.text.x = element_text(size = 12, face = \"bold\"),   \n        axis.text.y = element_text(size = 12, face = \"bold\"))\n\n\n\n\n\n\n\n\n\nggsave(\"fig/return.png\", dpi = 1000, bg = \"white\", height = 4, width = 6)\n\n\nSeason x Pressure\n\nscenarios_all %&gt;% \n   dplyr::group_by(season,pressure) %&gt;% \n  summarise(mean = mean(Net_hf),\n            median = median(Net_hf),\n     low_95 = quantile(Net_hf, 0.025),\n     up_95 = quantile(Net_hf, 0.975))\n\n`summarise()` has grouped output by 'season'. You can override using the\n`.groups` argument.\n\n\n\n  \n\n\n\n\n\nPressure\n\nscenarios_all %&gt;% \n   dplyr::group_by(pressure) %&gt;% \n  summarise(mean = mean(Net_hf),\n            median = median(Net_hf),\n     low_95 = quantile(Net_hf, 0.025),\n     up_95 = quantile(Net_hf, 0.975))"
  },
  {
    "objectID": "profit.html#relative-economic-reduction",
    "href": "profit.html#relative-economic-reduction",
    "title": "Framework modeling",
    "section": "Relative economic reduction",
    "text": "Relative economic reduction\n\nVariables\n\nlibrary(dplyr)\nlibrary(ggplot2)\nlibrary(ggthemes)\n\n\nAttaching package: 'ggthemes'\n\n\nThe following object is masked from 'package:cowplot':\n\n    theme_map\n\nset.seed(123)\n\n\n#mean_yld &lt;- 1883        # média estimada pelo modelo\n#se_yld   &lt;- 309         # erro padrão\n#price    &lt;- 0.20       # USD/kg\n\n\n#price &lt;- c(0.10, seq(0.10, 0.25, by = 0.05))\n\ncost_vec &lt;- c(0, seq(15, 105, by = 5))\nnsim &lt;- 1000\n\n# Grade total: cada simulação × cada custo\ndf_sim &lt;- expand.grid(\n  sim  = 1:nsim,\n  cost = cost_vec\n)\n\n\n\nSimulation\n\nlibrary(dplyr)\nlibrary(ggplot2)\nlibrary(ggthemes)\n\nset.seed(123)\n\ncost_vec &lt;- seq(0, 105, by = 5)\nnsim &lt;- 2000\n\n# função genérica para simular um cenário\nsim_scenario &lt;- function(mean, sd, label) {\n  expand.grid(\n    sim  = 1:nsim,\n    cost = cost_vec\n  ) %&gt;%\n    group_by(sim) %&gt;%\n    mutate(\n   \n     # yld   = runif(1, min = lower, max = upper),\n      yld   = rnorm(1,mean = mean, sd = sd),\n      price = runif(1, min = 0.10, max = 0.25),\n  \n      net   = yld * price - cost\n    ) %&gt;%\n\n    mutate(\n      net_ref = net[cost == 0],\n      loss_abs = net_ref - net,\n      loss_rel = 100 * loss_abs / abs(net_ref),\n      scenario = label\n    ) %&gt;%\n    ungroup()\n}\n\n# High attainable yield\n\ndf_high &lt;- sim_scenario(mean = 2480, sd = 327, label = \"High pressure\")\n\n# Low attainable yield\n\ndf_low  &lt;- sim_scenario(mean = 329, sd = 43, label = \"Low pressure\")\n\n# Joining\n\ndf_all &lt;- bind_rows(df_high, df_low)\n\nhead(df_all)\n\n\n  \n\n\n\n\ndf_all2 = df_all |&gt; \n  group_by(sim,scenario) |&gt; \n  summarise(slope = lm(loss_rel~0+cost)$coefficients) %&gt;% \n  full_join(df_all)\n\n`summarise()` has grouped output by 'sim'. You can override using the `.groups`\nargument.\nJoining with `by = join_by(sim, scenario)`\n\ndf_all2 = df_all2 %&gt;% \n  group_by(scenario) %&gt;% \n  summarise(mean = mean(slope),\n     up_95 = quantile(slope, 0.975),\n     low_95 = quantile(slope, 0.025)) %&gt;% \n  full_join(df_all2)\n\nJoining with `by = join_by(scenario)`\n\ndf_all2\n\n\n  \n\n\n\n\n\nPlotting\n\nRelative regression\n\nrl_plot = df_all2 |&gt; \n    filter(loss_rel &gt;=0) %&gt;% \n   filter(loss_rel &lt;= 100) %&gt;%\n  filter(slope&gt;0) %&gt;% \n  ggplot()+\n  geom_abline(aes(intercept = 0, slope = slope,color = scenario), alpha = 0.5, size = 0.09)+\n  geom_abline(aes(intercept = 0, slope = up_95), color = \"black\",, linetype = \"dashed\",size = 2)+\n    geom_abline(aes(intercept = 0, slope = mean), color = \"black\", linetype = \"solid\",size = 2)+\n    geom_abline(aes(intercept = 0, slope = low_95), color = \"black\", linetype = \"dashed\",size = 2)+\n  facet_wrap(~ scenario, ncol = 1) +\n   ggthemes::theme_few() +\n  scale_color_manual(values=c(\"darkgreen\", \"darkred\"))+#009628\n  xlim(0,105)+\n  ylim(0,100)+\n  scale_x_continuous(expand = c(0, 0),\n                     limits = c(0,105),\n                     breaks = seq(0, 105, by = 10)) +\n  scale_y_continuous(expand = c(0, 0),\n                     limits = c(0,100),\n                     breaks = seq(0, 100, by = 10))+\n  labs(\n    x = \"Management cost (USD/ha)\",\n    y = \"Economic reduction (%)\") +\n     geom_hline(yintercept = 50, linetype = \"dashed\", size = 1, color = \"black\")+\n theme(\n    text = element_text(face = \"bold\", size = 14),\n    axis.title = element_text(size = 20, face = \"bold\"),\n    axis.text.y = element_text(vjust = 1, size = 14, face = \"bold\"),\n     strip.text = element_text(size = 20, face = \"bold\"),\n    legend.position = \"none\",\n    legend.justification = 0.5,\n    panel.grid = element_blank())\n\nScale for x is already present.\nAdding another scale for x, which will replace the existing scale.\nScale for y is already present.\nAdding another scale for y, which will replace the existing scale.\n\nrl_plot\n\n\n\n\n\n\n\n\n\n\nRelative loss\n\nreturn_loss = df_all2 %&gt;% \n      filter(loss_rel &gt;=0) %&gt;% \n   filter(loss_rel &lt;= 100) %&gt;%\n    filter(slope&gt;0) %&gt;% \n  ggplot(aes(yld, fill = scenario))+\n  geom_histogram(color = \"white\", bins = 10)+\n  facet_wrap(~scenario, scale = \"free_x\")+\n  scale_fill_manual(values=c(\"darkgreen\", \"darkred\"))+\n  ggthemes::theme_few()+\n  labs(x = \"Yield response (kg/ha)\",\n       y = \"Frequency\")+\n  #scale_x_continuous(breaks = seq(0, 400, by = 100))+\n   theme(text = element_text(size = 14, face = \"bold\"),\n        axis.title = element_text(size = 20, face = \"bold\"),\n        strip.text = element_text(size = 20, face = \"bold\"),\n        title = element_text(face = \"bold\"),\n        legend.position = \"none\")\n\nreturn_loss\n\n\n\n\n\n\n\n\n\n\nSlope\n\nslope_loss = df_all2 %&gt;% \n    filter(loss_rel &gt;=0) %&gt;% \n   filter(loss_rel &lt;= 100) %&gt;%\n  filter(slope&gt;0) %&gt;% \n  ggplot(aes(slope, fill = scenario))+\n  geom_histogram(color = \"white\", bins = 10)+\n  facet_wrap(~scenario, scale = \"free_x\")+\n  scale_fill_manual(values=c(\"darkgreen\", \"darkred\"))+\n  ggthemes::theme_few()+\n  labs(x = \"Slope (%/p.p)\",\n       y = \"Frequency\")+\n  #scale_x_continuous(breaks = seq(0, 3, by = 0.5))+\n   theme(text = element_text(size = 14, face = \"bold\"),\n        axis.title = element_text(size = 20, face = \"bold\"),\n        strip.text = element_text(size = 20, face = \"bold\"),\n        title = element_text(face = \"bold\"),\n        legend.position = \"none\")\n\nslope_loss\n\n\n\n\n\n\n\n\n\n(rl_plot|return_loss/slope_loss)+\n  plot_annotation(tag_levels = \"a\", tag_prefix = \"(\", tag_suffix = \")\") + \n  theme(plot.tag = element_text(face = \"bold\", size = 12), label_x = -0.03, label_y = 1)\n\n\n\n\n\n\n\n\n\nggsave(\"fig/netreturn_loss.png\", bg = \"white\", dpi = 600, height = 8, width = 12)\n\n\n\nEconomic reference\n\nnet_ref = df_all2 %&gt;% \n  filter(loss_rel &gt;=0) %&gt;% \n   filter(loss_rel &lt;= 100) %&gt;%\n  filter(slope&gt;0) %&gt;% \n  ggplot(aes(net_ref, fill = scenario))+\n  geom_histogram(color = \"white\", bins = 10)+\n  scale_fill_manual(values=c(\"darkgreen\",\"darkred\"))+\n  facet_wrap(~scenario, scale = \"free\", nrow = 2)+\n  ggthemes::theme_few()+\n  labs(x = \"Net return initial (USD/ha)\",\n       y = \"Frequency\")+\n  #scale_x_continuous(breaks = seq(0, 3, by = 0.5))+\n   theme(text = element_text(size = 14, face = \"bold\"),\n        axis.title = element_text(size = 16, face = \"bold\"),\n        strip.text = element_text(size = 16, face = \"bold\"),\n        title = element_text(face = \"bold\"),\n        legend.position = \"none\")\n\nnet_ref\n\n\n\n\n\n\n\n\n\n\nMaize price\n\nprice_m = df_all2 %&gt;% \n  filter(loss_rel &gt;=0) %&gt;% \n   filter(loss_rel &lt;= 100) %&gt;%\n  filter(slope&gt;0) %&gt;% \n  ggplot(aes(price))+\n  geom_histogram(color = \"white\", bins = 10, fill = \"black\")+\n  ggthemes::theme_few()+\n  labs(x = \"Maize price (kg/ha)\",\n       y = \"Frequency\")+\n  #scale_x_continuous(breaks = seq(0, 3, by = 0.5))+\n   theme(text = element_text(size = 14, face = \"bold\"),\n        axis.title = element_text(size = 16, face = \"bold\"),\n        strip.text = element_text(size = 16, face = \"bold\"),\n        title = element_text(face = \"bold\"),\n        legend.position = \"none\")\n\nprice_m\n\n\n\n\n\n\n\n\n\n#(net_ref + price_m)+\n # plot_annotation(tag_levels = \"a\", tag_prefix = \"(\", tag_suffix = \")\") + \n  #theme(plot.tag = element_text(face = \"bold\", size = 12), label_x = -0.03, label_y = 1)\n\nplot_grid(net_ref, price_m,\n          labels = c(\"(a)\", \"(b)\"),\n  label_size = 16,          # tamanho da fonte das labels\n  label_fontface = \"bold\",  # coloca as labels em negrito\n  ncol = 2,                 # duas colunas\n  align = \"hv\", \n  label_x = -0.01,\n  label_y = 1)\n\nWarning: Graphs cannot be horizontally aligned unless the axis parameter is\nset. Placing graphs unaligned.\n\n\n\n\n\n\n\n\nggsave(\"fig/net_price.png\", bg = \"white\", dpi = 600, height = 6, width = 14)"
  },
  {
    "objectID": "blup.html",
    "href": "blup.html",
    "title": "Fitted model",
    "section": "",
    "text": "library(gsheet)\nlibrary(tidyverse)\n\n── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n✔ dplyr     1.1.4     ✔ readr     2.1.6\n✔ forcats   1.0.1     ✔ stringr   1.6.0\n✔ ggplot2   4.0.1     ✔ tibble    3.3.0\n✔ lubridate 1.9.4     ✔ tidyr     1.3.1\n✔ purrr     1.2.0     \n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\nℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors\n\nlibrary(lme4)\n\nLoading required package: Matrix\n\nAttaching package: 'Matrix'\n\nThe following objects are masked from 'package:tidyr':\n\n    expand, pack, unpack\n\nlibrary(metan)\n\n|=========================================================|\n| Multi-Environment Trial Analysis (metan) v1.19.0        |\n| Author: Tiago Olivoto                                   |\n| Type 'citation('metan')' to know how to cite metan      |\n| Type 'vignette('metan_start')' for a short tutorial     |\n| Visit 'https://bit.ly/metanpkg' for a complete tutorial |\n|=========================================================|\n\nAttaching package: 'metan'\n\nThe following object is masked from 'package:forcats':\n\n    as_factor\n\nThe following object is masked from 'package:dplyr':\n\n    recode_factor\n\nThe following object is masked from 'package:tidyr':\n\n    replace_na\n\nThe following objects are masked from 'package:tibble':\n\n    column_to_rownames, remove_rownames, rownames_to_column\n\nlibrary(DHARMa)\n\nThis is DHARMa 0.4.7. For overview type '?DHARMa'. For recent changes, type news(package = 'DHARMa')\n\nlibrary(metafor)\n\nLoading required package: metadat\nLoading required package: numDeriv\n\nLoading the 'metafor' package (version 4.8-0). For an\nintroduction to the package please type: help(metafor)\n\nlibrary(cowplot)\n\n\nAttaching package: 'cowplot'\n\nThe following object is masked from 'package:lubridate':\n\n    stamp"
  },
  {
    "objectID": "blup.html#packages",
    "href": "blup.html#packages",
    "title": "Fitted model",
    "section": "",
    "text": "library(gsheet)\nlibrary(tidyverse)\n\n── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n✔ dplyr     1.1.4     ✔ readr     2.1.6\n✔ forcats   1.0.1     ✔ stringr   1.6.0\n✔ ggplot2   4.0.1     ✔ tibble    3.3.0\n✔ lubridate 1.9.4     ✔ tidyr     1.3.1\n✔ purrr     1.2.0     \n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\nℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors\n\nlibrary(lme4)\n\nLoading required package: Matrix\n\nAttaching package: 'Matrix'\n\nThe following objects are masked from 'package:tidyr':\n\n    expand, pack, unpack\n\nlibrary(metan)\n\n|=========================================================|\n| Multi-Environment Trial Analysis (metan) v1.19.0        |\n| Author: Tiago Olivoto                                   |\n| Type 'citation('metan')' to know how to cite metan      |\n| Type 'vignette('metan_start')' for a short tutorial     |\n| Visit 'https://bit.ly/metanpkg' for a complete tutorial |\n|=========================================================|\n\nAttaching package: 'metan'\n\nThe following object is masked from 'package:forcats':\n\n    as_factor\n\nThe following object is masked from 'package:dplyr':\n\n    recode_factor\n\nThe following object is masked from 'package:tidyr':\n\n    replace_na\n\nThe following objects are masked from 'package:tibble':\n\n    column_to_rownames, remove_rownames, rownames_to_column\n\nlibrary(DHARMa)\n\nThis is DHARMa 0.4.7. For overview type '?DHARMa'. For recent changes, type news(package = 'DHARMa')\n\nlibrary(metafor)\n\nLoading required package: metadat\nLoading required package: numDeriv\n\nLoading the 'metafor' package (version 4.8-0). For an\nintroduction to the package please type: help(metafor)\n\nlibrary(cowplot)\n\n\nAttaching package: 'cowplot'\n\nThe following object is masked from 'package:lubridate':\n\n    stamp"
  },
  {
    "objectID": "about.html",
    "href": "about.html",
    "title": "About",
    "section": "",
    "text": "About\nThe dataset was obtained from four field experiments conducted under natural infection conditions of disease, being carried out in the years of 2018 and 2019 at Centro de Pesquisa Agrícola (Copacol) in Cafelândia, Paraná state, Brazil."
  },
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Linear modeling",
    "section": "",
    "text": "library(gsheet)\nlibrary(tidyverse)\nlibrary(lme4)\nlibrary(metan)\nlibrary(DHARMa)\nlibrary(metafor)\nlibrary(cowplot)"
  },
  {
    "objectID": "index.html#packages",
    "href": "index.html#packages",
    "title": "Linear modeling",
    "section": "",
    "text": "library(gsheet)\nlibrary(tidyverse)\nlibrary(lme4)\nlibrary(metan)\nlibrary(DHARMa)\nlibrary(metafor)\nlibrary(cowplot)"
  },
  {
    "objectID": "index.html#import-data",
    "href": "index.html#import-data",
    "title": "Linear modeling",
    "section": "Import data",
    "text": "Import data\n\ndados &lt;- gsheet2tbl(\"https://docs.google.com/spreadsheets/d/1pUGN7bPHtENsO8eb-f8J1q6_pbMqm86bVnaNlgClleo/edit?usp=sharing\")\n\n\nlibrary(tidyr)\nlibrary(dplyr)\n\ndados_long &lt;- dados %&gt;%\n  pivot_longer(\n    cols = c(poli, comum, branca, cercos, turc, diplo,antrac,bipol),\n    names_to = \"disease\",\n    values_to = \"value\"\n  )\n\n\nlibrary(dplyr)\n\nfreq_disease_season &lt;- dados_long %&gt;%\n  mutate(\n    value = as.numeric(value),\n    presente = ifelse(value &gt; 0.00, 1, 0)\n  ) %&gt;%\n  group_by(season, disease) %&gt;%\n  summarise(\n    n_presentes = sum(presente, na.rm = TRUE),\n    total = n(),\n    freq = round(n_presentes / total * 100, 1),\n    .groups = \"drop\"\n  )\n\n\n\n\ndados_long = dados_long %&gt;% \n  mutate(\n    type = case_when(disease == \"cercos\" ~ \"spot\",\n                     disease == \"turc\" ~ \"spot\",\n                     disease == \"diplo\" ~ \"spot\",\n                     disease == \"antrac\" ~ \"spot\",\n                     disease == \"bipol\" ~ \"spot\",\n                     disease == \"poli\" ~ \"rust\",\n                     disease == \"comum\" ~ \"rust\",\n                     disease == \"branca\" ~ \"rust\")\n  )"
  },
  {
    "objectID": "index.html#frequency",
    "href": "index.html#frequency",
    "title": "Linear modeling",
    "section": "Frequency",
    "text": "Frequency\n\nfrequency = dados_long %&gt;% \n  filter(application == \"check\") %&gt;% \n  group_by(season,hybrid,disease,location) %&gt;% \n  dplyr::summarise(\n    value = mean(value, na.rm = TRUE)\n  ) %&gt;% \n mutate(\n    value = as.numeric(value),\n    presente = ifelse(value &gt; 0.0, 1, 0)\n  ) %&gt;%\n  group_by(season, disease) %&gt;%\n  summarise(\n    n_presentes = sum(presente, na.rm = TRUE),\n    total = n(),\n    freq = round(n_presentes / total * 100, 1),\n    .groups = \"drop\"\n  )\n\nfrequency"
  },
  {
    "objectID": "index.html#mean-severity",
    "href": "index.html#mean-severity",
    "title": "Linear modeling",
    "section": "Mean severity",
    "text": "Mean severity\n\nmean_complex = dados_long %&gt;% \n  filter(!value &lt;= 0.0) %&gt;% \n  filter(application == \"check\") %&gt;% \n  group_by(season,disease) %&gt;% \n  dplyr::summarise(\n    value = mean(value, na.rm = TRUE)\n  )\n\nmean_complex"
  },
  {
    "objectID": "index.html#prepare-data",
    "href": "index.html#prepare-data",
    "title": "Linear modeling",
    "section": "Prepare data",
    "text": "Prepare data\n\ndados2 &lt;- dados |&gt; \n  mutate(trial = interaction(year, location, season, hybrid))\n\ndados3 &lt;- dados2 |&gt; \n  dplyr::group_by(trial, year, location, season, hybrid, technology, application) |&gt;\n  dplyr::summarize(sev = mean(severity),\n            yld = mean(yield2),\n            sd_sev = sd(severity),\n            sd_yld = sd(yield2),\n            n = n()\n            )\n\ndados_meta &lt;- dados3 %&gt;%\n  dplyr::select(trial, year, location, season, hybrid, technology, application, yld, sd_yld, n, sev) %&gt;%\n  pivot_wider(\n    names_from = application,\n    values_from = c(yld, sd_yld,n, sev),\n    names_sep = \"_\"\n  ) %&gt;%\n    dplyr::mutate(\n    study_id = paste(trial, year, location, season, hybrid, sep = \"_\"),\n    pressao = ifelse(sev_check &gt; 10, \"high\", \"low\"),\n    yi = yld_treated - yld_check,\n    sei = sqrt((sd_yld_treated^2 / n_treated) + (sd_yld_check^2 / n_check))\n  ) %&gt;%\n  drop_na(yi, sei) \n\ndados_meta\n\n\n  \n\n\n\n\n#writexl::write_xlsx(dados3,\"data/data3.xlsx\")\n\n\ndados_meta |&gt; \n  ungroup() |&gt; \n  count(hybrid) |&gt; \n  arrange(n)\n\n\n  \n\n\n\n\nSeverity\n\nlibrary(ggthemes)\n\nmetaa = dados_meta %&gt;% \n   filter(sev_check &gt;=5) %&gt;% \n  filter(yld_check &lt;= 12000)\n\n\nsev_plot = metaa %&gt;% \n  ggplot(aes(sev_check))+\n  geom_histogram(color = \"white\",fill = \"black\", bins = 10)+\n  facet_wrap(~season,labeller = as_labeller(c(\n    \"first\" = \"First\",\n    \"second\" = \"Second\"\n  )))+\n  theme_few()+\n  labs(x = \"Severity (%)\",\n       y = \"Frequency\")+\n  theme(text = element_text(size = 8, face = \"bold\"),\n        axis.text.x = element_text(size = 8, face = \"bold\", angle = 45, vjust = 0.5),   \n        axis.text.y = element_text(size = 8, face = \"bold\"),\n        axis.title = element_text(size = 12, face = \"bold\"),\n        strip.text = element_text(size = 12))\n\nsev_plot\n\n\n\n\n\n\n\n\n\nmetaa %&gt;% \n  group_by(season) %&gt;% \ndplyr::summarise(\n    min = min(sev_check),\n    max = max(sev_check),\n    sd = sd(sev_check),\n    mean = mean(sev_check),\n    n = n(),\n    se = sd/sqrt(n)\n  )\n\n\n  \n\n\n\n\nmetaa %&gt;% \n  group_by(year,season) %&gt;% \ndplyr::summarise(\n    min = min(sev_check),\n    max = max(sev_check),\n    sd = sd(sev_check),\n    mean = mean(sev_check),\n    n = n(),\n    se = sd/sqrt(n)\n  )\n\n\n  \n\n\n\n\n\nYield\n\nyield_plot = metaa %&gt;% \n  ggplot(aes(yld_check))+\n  geom_histogram(color = \"white\",fill = \"black\", bins = 10)+\n  scale_x_continuous(breaks = c(5000,7500,10000,12500),\n                     limits = c(5000, 12500))+\n  facet_wrap(~season,labeller = as_labeller(c(\n    \"first\" = \"\",\n    \"second\" = \" \"\n  )))+\n  theme_few()+\n  labs(x = \"Yield (kg/ha)\",\n       y = \"Frequency\")+\n  theme(text = element_text(size = 8, face = \"bold\"),\n        axis.text.x = element_text(size = 8, face = \"bold\", angle = 45, vjust = 0.5),   \n        axis.text.y = element_text(size = 8, face = \"bold\"),\n        axis.title = element_text(size = 12, face = \"bold\"),\n        strip.text = element_text(size = 12))\nyield_plot\n\n\n\n\n\n\n\n\n\nmetaa %&gt;% \n  group_by(season) %&gt;% \ndplyr::summarise(\n    min = min(yld_check),\n    max = max(yld_check),\n    sd = sd(yld_check),\n    mean = mean(yld_check),\n    n = n(),\n    se = sd/sqrt(n)\n  )\n\n\n  \n\n\n\n\nmetaa %&gt;% \n  group_by(year,season) %&gt;% \ndplyr::summarise(\n    min = min(yld_check),\n    max = max(yld_check),\n    sd = sd(yld_check),\n    mean = mean(yld_check),\n    n = n(),\n    se = sd/sqrt(n)\n  )\n\n\n  \n\n\n\n\n\nMap\n\nlibrary(dplyr)\nlibrary(ggplot2)\nlibrary(ggrepel)\nlibrary(maps)\n\n\n# Número de híbridos por location + coordenadas\nloc_hybrids &lt;- dados %&gt;%\n  group_by(location, season, lat, lon) %&gt;%\n  summarise(n_hybrids = n_distinct(hybrid), .groups = \"drop\")\n\nloc_hybrids$lat = NULL\nloc_hybrids$lon = NULL\nloc_hybrids$lat = c(-24.09,-24.09,-23.356,-26.1255)\nloc_hybrids$lon = c(-52.356389,-52.356389,-51.158889,-52.65)\n\nlibrary(scales)\nlibrary(ggspatial) \nlibrary(gsheet)\nlibrary(ggrepel)\nlibrary(cowplot)\nlibrary(rnaturalearth)\nlibrary(rnaturalearthdata)\nlibrary(sf)\nlibrary(tidyverse)\n\n#install.packages(\"devtools\") # I guess you also need this\n#devtools::install_github(\"ropensci/rnaturalearthhires\")\n\nBRA = ne_states(\n  country = \"Brazil\",\n  returnclass = \"sf\"\n)\nlibrary(geobr)\nmunicipios &lt;- read_municipality(code_muni = \"all\", year = 2020)\nmunicipios = municipios %&gt;% filter(name_state ==  c(\"Paraná\"))\n\nstates &lt;- filter(BRA, \n                 name_pt == \"Paraná\")\nunique(BRA$name_pt)\n\n [1] \"Rio Grande do Sul\"   \"Roraima\"             \"Pará\"               \n [4] \"Acre\"                \"Amapá\"               \"Mato Grosso do Sul\" \n [7] \"Paraná\"              \"Santa Catarina\"      \"Amazonas\"           \n[10] \"Rondônia\"            \"Mato Grosso\"         \"Maranhão\"           \n[13] \"Piauí\"               \"Ceará\"               \"Rio Grande do Norte\"\n[16] \"Paraíba\"             \"Pernambuco\"          \"Alagoas\"            \n[19] \"Sergipe\"             \"Bahia\"               \"Espírito Santo\"     \n[22] \"Rio de Janeiro\"      \"São Paulo\"           \"Goiás\"              \n[25] \"Federal\"             \"Minas Gerais\"        \"Tocantins\"          \n\nstates = states %&gt;% \n  mutate(id = case_when(\n    name_pt == \"Paraná\" ~ \"PR\"))\n\nSUL = ne_states(\n  country = c(\"Argentina\", \"Uruguay\", \"Paraguay\", \"Colombia\", \"Bolivia\"),\n  returnclass = \"sf\")\n\nbr_sf &lt;- ne_states(geounit = \"brazil\",\n                   returnclass = \"sf\")\n\n\nlibrary(ggplot2)\nlibrary(cowplot)  \n\nlibrary(ggplot2)\nlibrary(ggrepel)\nlibrary(dplyr)\nlibrary(ggthemes)\nlibrary(ggspatial)\nloc_hybrids &lt;- loc_hybrids[-1, ]\nmap3 &lt;- loc_hybrids |&gt;\n  ggplot() +\n  \n  # Mapa base do Brasil\n  geom_sf(data = BRA, fill = \"white\", color = \"gray60\", size = 0.4) +\n  \n  # Destacar o Paraná\n  geom_sf(data = subset(BRA, postal %in% c(\"PR\")), \n          fill = NA, color = \"black\", size = 1) +\n  \n  # Siglas dos estados\n  geom_text(data = states, aes(x = longitude, y = latitude, label = id), \n            size = 5, hjust = 0.8, color = \"black\", fontface = \"bold\") +\n  \n  # Pontos das localidades\n  geom_point(data = loc_hybrids, aes(x = lon, y = lat), \n             alpha = 0.8) +\n  \n  # Nomes das cidades com linhas\n  geom_text_repel(\n    data = loc_hybrids,\n    aes(x = lon, y = lat, label = location),\n    size = 4,\n    fontface = \"bold\",\n    color = \"black\",\n    min.segment.length = 0,\n    box.padding = 0.3,\n    segment.color = \"gray30\",\n    segment.size = 0.4\n  ) +\n  \n  # Tema e ajustes de mapa\n  theme_minimal_grid() +\n  coord_sf(xlim = c(-58, -45), ylim = c(-27, -22), expand = FALSE) +\n  \n  # Legenda personalizada\n  guides(size = FALSE,  \n         color = guide_colorbar(title = \"Severity (%)\", \n                                direction = \"horizontal\",\n                                title.position = \"top\")) +\n  \n  # Estilo da legenda e borda do painel\n  theme(\n    legend.position = c(0.9, 0.01),  \n    legend.justification = c(1, 0),\n    legend.direction = \"horizontal\",\n    legend.title.align = 0.5,\n    panel.border = element_rect(color = \"black\", fill = NA, size = 1),\n    axis.title = element_text(face = \"bold\")\n  ) +\n  \n  # Adiciona seta de norte\n  annotation_north_arrow(location = \"br\", which_north = \"true\", \n                         pad_x = unit(5.86, \"in\"), pad_y = unit(0.3, \"in\"), \n                         style = north_arrow_fancy_orienteering, \n                         height = unit(1.2, \"cm\"), width = unit(1.1, \"cm\")) +\n  \n  # Barra de escala\n  annotation_scale(location = \"br\", \n                   width_hint = 0.1, \n                   height = unit(0.2, \"cm\"), \n                   text_cex = 0.6, \n                   pad_x = unit(5.8, \"in\"), \n                   pad_y = unit(0.2, \"in\")) +\n  \n  # Eixos\n  labs(x = \"Longitude\", y = \"Latitude\")\n\nmap3\n\n\n\n\n\n\n\n\n\npr_municipios &lt;- read_municipality(code_muni = \"all\", year = 2020) %&gt;%\n  filter(name_state == \"Paraná\")\n\nBRA &lt;- ne_states(country = \"Brazil\", returnclass = \"sf\")\npr_estado &lt;- BRA %&gt;% filter(name_pt == \"Paraná\")\nmap2 = loc_hybrids #|&gt; filter(estado == \"PR\")\n\nmapa_brasil &lt;- ggplot() +\n  geom_sf(data = BRA, fill = \"white\", color = \"black\", size = 0.2) +  \n  geom_sf(data = subset(BRA, postal %in% c(\"PR\")), \n          fill = \"gray40\", color = \"black\", size = 0.6) +  \n  theme_map() +\n    theme(\n    panel.background = element_rect(fill = \"white\", color = NA),  \n    plot.background = element_rect(fill = \"white\", color = NA),   \n    panel.border = element_rect(color = \"black\", fill = NA, size = 1)) \n\n\nlibrary(patchwork)\nmapp = map3 + \n  inset_element(mapa_brasil, \n                left = 0.8, bottom = 0.5,  \n                right = 0.99, top = 0.95) \n\n\nlibrary(cowplot)\n\n\nright_panel &lt;- plot_grid(\n  sev_plot, yield_plot,\n  ncol = 1,\n  labels = c(\"(b)\", \"(c)\"),\n  label_size = 14,\n  label_fontface = \"bold\",\n  align = \"v\"\n)\n\n\nfinal_plot &lt;- plot_grid(\n  mapp, right_panel,\n  ncol = 2,\n  rel_widths = c(2, 1),     \n  labels = c(\"(a)\",\"\"),\n  label_size = 14,\n  label_fontface = \"bold\",\n  label_x = 0.02,\n  label_y = 0.98,\n  align = \"h\"\n)\n\nfinal_plot\n\n\n\n\n\n\n\nggsave(\"fig/map4.png\", height=4, width=10, dpi = 600, bg = \"white\")\n\n\ndados_meta |&gt; \n  ggplot(aes(season, sev_check))+\n  geom_boxplot()\n\n\n\n\n\n\n\n\n\nplot_box_sev =metaa |&gt; \n  ggplot(aes(factor(year), sev_check, color = season))+\n  geom_boxplot(size = 1)+\n  theme_few()+\n  scale_y_continuous(breaks = seq(5, 30, by = 5)) +\n# scale_color_viridis_d(option = \"E\", direction =  -1,\n #                       labels = c(\"first\" = \"First\", \"second\" = \"Second\"))+\n  scale_color_manual(values=c(\"darkred\", \"darkgreen\"),\n                        labels = c(\"first\" = \"First\", \"second\" = \"Second\"))+\n  labs(x = \"\",\n       y = \"Severity (%)\",\n       color = \"\")+\n  theme(text = element_text(size = 12, face = \"bold\"),\n        axis.text.x = element_blank())\n\nplot_box_sev\n\n\n\n\n\n\n\n\n\nplot_box_yld = metaa |&gt; \n  ggplot(aes(factor(year), yld_check, color = season))+\n  geom_boxplot(size = 1)+\n  theme_few()+\n  scale_y_continuous(breaks = seq(3000, 12000, by = 1500)) +\n  #scale_color_viridis_d(option = \"E\", direction =  -1,\n   #                     labels = c(\"first\" = \"First\", \"second\" = \"Second\"))+\n  scale_color_manual(values=c(\"darkred\", \"darkgreen\"),\n                        labels = c(\"first\" = \"First\", \"second\" = \"Second\"))+  \n  labs(x = \"Year\",\n       y = \"Yield (kg/ha)\",\n       color = \"\")+\n  theme(text = element_text(size = 12, face = \"bold\"))\n\nplot_box_yld\n\n\n\n\n\n\n\n\n\nlibrary(patchwork)\n\n(plot_box_sev/plot_box_yld)+\n  plot_annotation(tag_levels = \"a\", tag_prefix = \"(\", tag_suffix = \")\")+\n  theme(plot.tag = element_text(face = \"bold\", size = 12))\n\n\n\n\n\n\n\n\n\nggsave(\"fig/yld_sev.png\", dpi = 1000, bg = \"white\", height = 4, width = 6)\n\n\nmetaa %&gt;% \n  ggplot(aes(sev_check,yld_check))+\n  geom_point(size = 4, color = \"gray\")+\n  theme_few()+\n  geom_smooth(method = \"gam\", color = \"black\", size = 3)+\n    theme(text = element_text(size = 12, face = \"bold\"))+\n  labs(x = \"Severity (%)\",\n       y = \"Yield (kg/ha)\")\n\n\n\n\n\n\n\n\n\ndd = dados3 %&gt;% \n # filter(!season == \"first\") %&gt;% \n  filter(sev &gt;=5) %&gt;% \n  filter(yld &lt;=12000)\n\n\ndd %&gt;% \n  ggplot(aes(sev,yld))+\n  geom_point()"
  },
  {
    "objectID": "index.html#contrast",
    "href": "index.html#contrast",
    "title": "Linear modeling",
    "section": "Contrast",
    "text": "Contrast\n\nApplication x season x pressure\n\nlibrary(emmeans)\n\n\nemm = emmeans(test_l, ~ application * season*pressao)\n\nmm = contrast(emm, method = \"revpairwise\", by = c(\"season\",\"pressao\"))\nconfint(mm)\n\n\n  \n\n\n\n\n\nApplication x season\n\nemm_as = emmeans(test_l, ~ application * season)\nmm_as = contrast(emm_as, method = \"revpairwise\", by = \"season\")\nconfint(mm_as)\n\n\n  \n\n\n\n\n\nAplication x pressure\n\nemm2 = emmeans(test_l, ~ application * pressao)\nmm2 = contrast(emm2, method = \"revpairwise\", by = \"pressao\")\n\nsummary(mm2)\n\n\n  \n\n\nconfint(mm2)\n\n\n  \n\n\n\n\nsaveRDS(test_l, file = \"data/lmer.rds\")"
  }
]